# NIRS仕様要約

## NIRSとは

脳の活動を計測するデバイスで、血流を光センサーにより測る事が出来る。
脳波計（EEG）と類似する技術だが、より廉価で高性能な代わりに、反応速度にる。
応用例としては、精神病（うつ病・躁うつ・統合失調症）の識別（光トポグラフィー）が有名1。


## メカニズム

2種類のLED及び光センサーを使用し、酸素化ヘモグロビン及び脱酸素化ヘモグロビンの変化量を求める。

  1. LED、及び光センサーを頭部に約3cm間隔で配置する。
  2. LEDを交互に点滅させ、脳表面の血液による光反射を光センサーで取得する。

以上により吸光度変化量（光センサーの値の変化）、及び連立方程式を使用することにより、酸素化ヘモグロビン及び脱酸素化ヘモグロビンの変化量を求める事が出来る。


### 変化量を求める数式

岡田（2010）より

```
∆OD = In(I1/I2) = ∆μα< Lact >
= εoxy-Hb ∆Coxy-Hb< Lact > + εdeoxy-Hb ∆deCoxy-Hb< Lact >
```

  * OD: 減光度（入射光強度と検出光強度の比）
  * < Lact >: 部分実効光路長
  * μα: 組織の吸収係数
  * I1: 賦活前の強度
  * I2: 賦活後の強度
  * εoxy-Hb: 酸素化ヘモグロビンのモル吸光係数
  * ∆Coxy-Hb: 酸素化ヘモグロビンの濃度変化
  * εdeoxy-Hb: 脱酸素化ヘモグロビンのモル吸光係数
  * ∆Cdeoxy-Hb: 脱酸素化ヘモグロビンの濃度変化

酸素化・脱酸素化ヘモグロビンのモル吸光係数は光周波数により異なる為、連立方程式で求める事が出来る。

  * εoxy-Hb（660nm）: 7.9207E-04
  * εoxy-Hb（850nm）: 1.8096E-04
  * εdeoxy-Hb（660nm）: 7.7025E-05
  * εdeoxy-Hb（850nm）: 2.6694E-04


## ハードウェア部品制定

  * MCU: ESP32
    * 入手性が高く計算速度が速いが、消費電力が高く、設計があまり優秀ではない。
  * ADC: ADS1256
    * 24bitADC、速度も十分。
  * 電源IC: TPS7A4700
    * 超低ノイズの上、最大1Aの供給が可能な為。
  * 光センサー: OPT101
    * NIRS作成関連の論文で多用されている。赤外線センサーを使用するNIRSと相性が良く、精度がそれなりに良い。


## 通信プログラム

  * NIRSデバイスとPC・スマートフォン間の接続にはイーサネットを使用する。
    * シリアル・USB通信と比較すると、無線で接続出来、なおかつ機種ごとの相性問題が生じにくい為。
    * Bluetoothはライセンス料が高く、低速、接続そのものが不安定の為、相性問題を考えるとイーサネットの方が優れている。
  * 通信規格はhttp+Telnetを使用する予定。
    * 接続先WiFiや設定はhttp、データ通信はTelnetで行う予定。
    * 他にもMQTTが有力だったが、1対1で短距離接続をする為、Telnetの方が扱いやすいと判断した。


## 受信クライアント使用

  * 言語にはJavaScriptを使用する。
    * あらゆる環境でも動作出来るから。
  * 将来的に機械学習を入れる事により、BCI等への活用が可能と考える。



## 引用元

岡田 英史(2010), 光伝播シミュレーションによるNIRS信号の解釈に関する検討

https://www.jstage.jst.go.jp/article/ninchishinkeikagaku/12/1/12_1_44/_pdf/-char/ja

  